# HotelBookingSystem

**HotelBookingSystem** — это backend-сервис для управления бронированиями отелей, реализованный на платформе ASP.NET Core с использованием современных подходов в архитектуре и безопасности. 
Проект разрабатывался как учебно-практический, но с ориентацией на реальные бизнес-задачи.

---

## Основные возможности

- Регистрация и аутентификация пользователей по ролям (JWT: Access/Refresh токены)
- Подтверждение email и бронирований через токены
- Управление бронированиями (создание, изменение, отмена)
- Роль менеджер имеет возможность управлять отелями, комнатами, бронированиями (создание, изменение, публикация/сокрытие, подтверждение, отмена)
- Email-уведомления с HTML-шаблонами
- Кэширование популярных GET-запросов с помощью Redis
- Защита от слишком частых запросов (HTTP 419 Too Many Requests)
- Swagger-документация
- Контейнеризация через Docker
- Модульная архитектура, CQRS (MediatR), многослойный подход

---

## Быстрый старт

### Требования:

- [.NET 8 SDK](https://dotnet.microsoft.com/download) - для компиляции и работы с проектом
- [ASP.NET Core Runtime 8](https://dotnet.microsoft.com/en-us/download/dotnet/8.0/runtime) - для запуска API-приложения вне SDK
- [Docker](https://www.docker.com/)
- PostgreSQL (локально или в Docker)
- SMTP-сервер для отправки писем

### 1. Клонирование репозитория

```bash
git clone https://github.com/skymxxn/HotelBookingSystem.git
```

### 2. Настройка переменных окружения

Скопируйте и отредактируйте `.env`:

```bash
cp .env.template .env
```

Укажите:
- SMTP-данные
- Секреты для JWT
- Подключение к PostgreSQL
- Admin credentials

### 3. Создание миграций

Восстановить локальные инструменты:
```bash
dotnet tool restore
```

Создание миграций:
```bash
dotnet ef migrations add InitialCreate --project src/HotelBookingSystem.Persistence --startup-project src/HotelBookingSystem.API
```

### 4. Запуск проекта

```bash
docker-compose up --build
```

### 5. Доступ

- API: [http://localhost:8080/api/hotels](http://localhost:8080)  
- Swagger: [http://localhost:8080/swagger](http://localhost:8080/swagger)

---

## Архитектура и структура

Проект построен по принципу **модульного монолита** с чётким разделением ответственности:

```
src/
├── HotelBooking.API             // Точка входа, маршрутизация, middleware
├── HotelBooking.Application     // Бизнес-логика, CQRS, DTO, валидации
├── HotelBooking.Infrastructure  // Email-сервис, кэш, JWT
├── HotelBooking.Persistence     // EF Core, миграции, контекст
└── HotelBooking.Domain          // Доменные сущности, правила, контракты
```

---

## Аутентификация и безопасность

- Используется JWT (Access и Refresh токены)
- Подтверждение email через токен-ссылку
- Отдельный токен для подтверждения бронирования
- Сброс пароля через токен-ссылку
- Конфигурация токенов через `appsettings.json` и `IOptions`

---

## Кастомный AccessService

В проекте используется `IAccessService` — специальный сервис для фильтрации доступа к данным на уровне запросов.
Это помогает централизованно управлять доступом к данным, не размазывая условия по всем хендлерам или контроллерам.

**Реализация:** `AccessService` из `Infrastructure.Services.Access`

Сервис обрабатывает запросы к данным на основе текущего пользователя, определяя, кто и какие записи может видеть:

- **Booking**:
  -  Пользователь видит только свои бронирования
  -  Менеджер — только бронирования в своих отелях
  -  Гость (неавторизованный) — ничего не видит
- **Hotel** и **Room**:
  -  Пользователь видит только опубликованные и одобренные
  -  Менеджер — только свои объекты
  -  Гость — также как и пользователь, видит только опубликованные и одобренные

---

## Email-уведомления

Интеграция с SMTP. Поддерживаются следующие события:

- Подтверждение email
- Создание бронирования
- Сброс пароля

Каждое письмо оформлено в виде HTML-шаблона.

---

## Кэширование

- Используется `Redis`  
- Реализован `IRedisCacheService` для централизованной логики кэширования
- Кэшируются часто запрашиваемые данные (например, список отелей и номеров)

---

## Тестовый пользователь

При первом запуске создаётся администратор:

```
Email: your_admin_email@example.com
Пароль: YourSecureAdminPassword123!
```

Изменения - в `.env`.

---

## Возможности для развития

- OAuth2 / Social login (Google, GitHub)
- Очереди (RabbitMQ / Kafka)
- Интеграционные и нагрузочные тесты
- Улучшенная RBAC-авторизация

---

---

## Автор

Разработчик: [Руслан (skymxxn)](https://github.com/skymxxn)  
Специализация: Backend (.NET)  
Проект создан как showcase с прицелом на продакшн-качество и понимание архитектурных паттернов.

Если есть желание пообщаться, дать фидбек или предложить сотрудничество - пишите в [Telegram](https://t.me/skymxxn)
